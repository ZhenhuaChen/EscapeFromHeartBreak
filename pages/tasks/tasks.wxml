<!--tasks.wxml-->
<navigation-bar title="ä»»åŠ¡æ‰“å¡" background="linear-gradient(90deg, #ffc0e0 0%, #ffe5f0 100%)" color="#333" back="{{false}}"></navigation-bar>

<view class="container">
  <view class="header">
    <view class="title">ä»Šæ—¥ä»»åŠ¡</view>
    <view class="date">{{todayDate}}</view>
  </view>

  <view class="daily-task-card">
    <view class="task-header">
      <text class="task-day">Day {{detoxDays}}</text>
      <text class="task-status {{todayTaskCompleted ? 'completed' : ''}}">
        {{todayTaskCompleted ? 'å…¨éƒ¨å®Œæˆ' : 'è¿›è¡Œä¸­'}}
      </text>
    </view>
    <view class="task-content">
      <view class="task-title">{{todayTask.title}}</view>
      <view class="task-desc">{{todayTask.desc}}</view>
    </view>
    <view class="task-hint">
      <text>ğŸ‘‡ ç‚¹å‡»ä¸‹æ–¹å®Œæˆä»Šæ—¥ä»»åŠ¡æ‰“å¡</text>
    </view>
    <view wx:if="{{!todayTaskCompleted && tasksList.length > 0}}" class="today-tasks-list">
      <view
        wx:for="{{tasksList}}"
        wx:key="id"
        class="today-task-item {{item.completed ? 'completed' : ''}}"
        bindtap="handleTaskTap"
        data-task-id="{{item.id}}"
      >
        <view class="task-checkbox {{item.completed ? 'checked' : ''}}"
>
          <text wx:if="{{item.completed}}" class="check-icon">âœ“</text>
        </view>
        <view class="task-name">{{item.title}}</view>
      </view>
    </view>
    <view wx:if="{{todayTaskCompleted}}" class="completed-time">
      å®Œæˆæ—¶é—´ï¼š{{completedTimeStr}}
    </view>
  </view>

  <view class="custom-tasks-section">
    <view class="section-header">
      <view class="section-title">æˆ‘çš„å¾…åŠ</view>
      <button wx:if="{{customTasks.length < 5}}" class="add-task-btn" bindtap="showAddTaskDialog">
        <text class="add-icon">+</text>
      </button>
    </view>

    <view wx:if="{{customTasks.length === 0}}" class="empty-tasks">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">è¿˜æ²¡æœ‰è‡ªå®šä¹‰ä»»åŠ¡</text>
      <text class="empty-tip">ç‚¹å‡»å³ä¸Šè§’ + æ·»åŠ å¾…åŠäº‹é¡¹</text>
    </view>

    <view wx:else class="custom-tasks-list">
      <view
        wx:for="{{customTasks}}"
        wx:key="id"
        class="custom-task-item {{item.completed ? 'completed' : ''}}"
      >
        <view class="task-checkbox {{item.completed ? 'checked' : ''}}" bindtap="toggleCustomTask" data-id="{{item.id}}">
          <text wx:if="{{item.completed}}" class="check-icon">âœ“</text>
        </view>
        <view class="task-content">
          <view class="task-text">{{item.content}}</view>
          <view wx:if="{{item.completed}}" class="task-time">å®Œæˆäº {{item.completedTimeStr}}</view>
        </view>
        <view class="task-delete" bindtap="deleteCustomTask" data-id="{{item.id}}">
          <text>Ã—</text>
        </view>
      </view>
    </view>

    <view class="task-count">{{customTasks.length}}/5</view>
  </view>
</view>

<!-- é¼“åŠ±å¼¹çª— -->
<view wx:if="{{showEncouragement}}" class="encouragement-modal" bindtap="closeEncouragement">
  <view class="encouragement-content" catchtap="stopPropagation">
    <view class="encouragement-icon">ğŸ‰</view>
    <view class="encouragement-title">ä»»åŠ¡å®Œæˆï¼</view>
    <view class="encouragement-message">{{encouragementMessage}}</view>
    <button class="encouragement-btn" bindtap="closeEncouragement">ç»§ç»­åŠ æ²¹</button>
  </view>
</view>

<!-- æ·»åŠ ä»»åŠ¡å¼¹çª— -->
<view wx:if="{{showAddDialog}}" class="add-task-modal" bindtap="closeAddDialog">
  <view class="add-task-content" catchtap="stopPropagation">
    <view class="dialog-title">æ·»åŠ å¾…åŠäº‹é¡¹</view>
    <textarea
      class="task-input"
      placeholder="è¾“å…¥å¾…åŠäº‹é¡¹..."
      maxlength="50"
      value="{{newTaskContent}}"
      bindinput="handleTaskInput"
      auto-focus
    />
    <view class="dialog-buttons">
      <button class="cancel-btn" bindtap="closeAddDialog">å–æ¶ˆ</button>
      <button class="confirm-btn" bindtap="addCustomTask">ç¡®å®š</button>
    </view>
  </view>
</view>
