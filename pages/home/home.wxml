<!--home.wxml-->
<navigation-bar title="å¤±æ‹æˆ’æ–­" background="linear-gradient(90deg, #ffc0e0 0%, #ffe5f0 100%)" color="#333" back="{{false}}"></navigation-bar>

<view class="container">
  <!-- é¡¶éƒ¨çŠ¶æ€å¡ç‰‡ -->
  <view class="status-card">
    <view class="greeting">ä½ å¥½ï¼Œ{{userProfile.nickname}}</view>
    <view class="recovery-plan">
      <text class="plan-text">{{recoveryDays}}å¤©æ¢å¤è®¡åˆ’</text>
    </view>
    <view class="days-info">
      <view class="days-item">
        <text class="days-number">{{detoxDays}}</text>
        <text class="days-label">å·²åšæŒ</text>
      </view>
      <view class="days-item">
        <text class="days-number">{{recoveryDays - detoxDays}}</text>
        <text class="days-label">å‰©ä½™å¤©æ•°</text>
      </view>
      <view class="days-item">
        <text class="days-number">{{completedTasksCount}}/{{totalTasksCount}}</text>
        <text class="days-label">å®Œæˆä»»åŠ¡</text>
      </view>
    </view>
  </view>

  <!-- è¿›åº¦æ¡ -->
  <view class="progress-section">
    <view class="progress-header">
      <text class="progress-title">æ¢å¤è¿›åº¦</text>
      <text class="progress-percent">{{progressPercent}}%</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{progressPercent}}%"></view>
    </view>
    <view class="progress-tip">{{progressTip}}</view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="tasks-section">
    <view class="section-title">ä»Šæ—¥ä»»åŠ¡ (Day {{detoxDays}})</view>
    <view wx:if="{{tasksList.length === 0}}" class="no-tasks">
      <text class="no-tasks-icon">ğŸ‰</text>
      <text class="no-tasks-text">ä»Šå¤©æ²¡æœ‰æ–°ä»»åŠ¡</text>
      <text class="no-tasks-tip">å¥½å¥½äº«å—è½»æ¾çš„ä¸€å¤©å§</text>
    </view>
    <view wx:else class="tasks-list">
      <view
        wx:for="{{tasksList}}"
        wx:key="id"
        class="task-item {{item.completed ? 'completed' : ''}}"
      >
        <view class="task-left">
          <view class="task-checkbox {{item.completed ? 'checked' : ''}}" bindtap="handleToggleTask" data-id="{{item.id}}">
            <text wx:if="{{item.completed}}" class="check-icon">âœ“</text>
          </view>
          <view class="task-info">
            <view class="task-title">
              <text>{{item.title}}</text>
            </view>
            <view class="task-desc">{{item.desc}}</view>
            <view wx:if="{{item.completed}}" class="task-date">å®Œæˆäº {{item.dateStr}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <button class="action-btn emergency-btn" bindtap="goToEmergency">
      <text class="btn-icon">ğŸ’Š</text>
      <text class="btn-text">æƒ…ç»ªæ€¥æ•‘</text>
    </button>
    <button class="action-btn emotion-btn" bindtap="recordEmotion">
      <text class="btn-icon">ğŸ“</text>
      <text class="btn-text">è®°å½•æƒ…ç»ª</text>
    </button>
  </view>
</view>
