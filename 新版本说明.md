# 逃出失恋 - 新版本功能说明

## 🎉 新版本已完成！

根据你的需求，我已经完全重构了问卷流程和天数计算系统。

---

## ✨ 新功能亮点

### 1. **优化的用户信息采集**
- 昵称
- **年龄**（新增）

### 2. **单题展示问卷（10个问题）**
每次只显示一个问题，带顶部进度条，体验更专注：

1. **性别**：男性 / 女性
2. **分手多久了**：不到1周 ~ 6个月以上（5个选项）
3. **关系持续时间**：不到1个月 ~ 5年以上（6个选项）
4. **当前感觉如何**：震惊中 ~ 感觉好多了（5个选项）
5. **联系频率**：每天都有 ~ 从不（4个选项）
6. **谁结束的关系**：我/前任/相互/复杂（4个选项）
7. **查看动态频率**：每天多次 ~ 从不/已拉黑（4个选项）
8. **最大困扰**：想念前任 ~ 感到自责（7个选项）
9. **应对方式**：保持忙碌 ~ 不知道怎么办（5个选项）
10. **愈合进度**：完全没有 ~ 感觉好多了（4个选项）

### 3. **目标选择页面**
10个恢复目标供用户选择：
- 忘记我的前任
- 重新感到快乐
- 重建信心
- 睡得更好
- 停止哭泣
- 重新爱自己
- 重新相信爱情
- 开始新的事物
- 寻找内心的平静
- 与朋友重新联系

### 4. **计算中动画页面**
- 爱心loading动画
- 显示分析进度：
  - ✓ 持续时间和情感影响
  - ✓ 分手原因与我回方向
  - ✓ 前任联系频率

### 5. **智能天数计算算法**

**恢复天数范围：21-60天**

10个枚举值：`21、25、30、35、40、45、50、54、57、60天`

#### 计算逻辑（总分100分）：

| 问题 | 权重 | 说明 |
|------|------|------|
| 分手时长 | 15分 | 分手越早，需要时间越长 |
| 关系持续时间 | 15分 | 关系越长，恢复越难 |
| 当前感觉 | 15分 | 感觉越差，需要更多时间 |
| 联系频率 | 10分 | 联系越频繁，恢复越难 |
| 谁结束的 | 10分 | 被动分手更难接受 |
| 查看动态 | 10分 | 查看越频繁，越难放下 |
| 最大困扰 | 10分 | 不同困扰影响不同 |
| 应对方式 | 8分 | 积极应对恢复更快 |
| 愈合进度 | 7分 | 当前进展影响总时长 |

**映射规则**：
- 总分 0-10分 → 21天
- 总分 11-20分 → 25天
- 总分 21-30分 → 30天
- ...以此类推
- 总分 90-100分 → 60天

### 6. **结果展示页面**
- 显示最终恢复天数
- 提示用户开始恢复之旅
- 酷炫的动画效果

### 7. **动态任务系统**
根据恢复天数自动生成对应任务：

**任务模板（10个）**：
- Day 1：开始记录心情
- Day 3：清理联系方式
- Day 5：24小时不看TA动态
- Day 7：写一封永不发送的信
- Day 10：尝试新的兴趣
- Day 14：第一次社交复健
- Day 18：整理生活空间
- Day 21：运动打卡
- Day 25：感恩清单
- Day 30：情绪复盘

**示例**：
- 如果用户恢复天数是 **25天**，则显示前7个任务
- 如果用户恢复天数是 **45天**，则显示前9个任务
- 如果用户恢复天数是 **60天**，则显示全部10个任务

### 8. **主页优化**
显示内容：
- **X天恢复计划**（总天数）
- **已坚持**：当前天数
- **剩余天数**：总天数 - 当前天数
- **完成任务**：X/Y

---

## 🔄 完整流程

```
欢迎页
  ↓
基础信息（昵称 + 年龄）
  ↓
10个问题（单题展示，带进度条）
  ↓
选择恢复目标
  ↓
计算中动画（3秒）
  ↓
显示恢复天数结果
  ↓
进入主页（开始打卡）
```

---

## 📁 新增文件

```
pages/questionnaire/     # 问卷页面（单题展示）
pages/goalSelect/        # 目标选择页面
pages/result/            # 结果展示页面（含计算动画）
utils/calculator.js      # 智能天数计算算法
```

---

## 🔧 修改的文件

```
app.json                 # 注册新页面
app.js                   # 动态任务生成逻辑
pages/userInfo/          # 改为采集昵称+年龄
pages/home/              # 显示恢复天数和剩余天数
```

---

## 🚀 如何测试

### 1. 清除旧数据
在微信开发者工具控制台执行：
```javascript
wx.clearStorageSync()
```

### 2. 重新编译运行

### 3. 完整体验流程
1. 欢迎页 → 点击"开始恢复之旅"
2. 输入昵称和年龄 → 下一步
3. 回答10个问题（每题自动跳转）
4. 选择恢复目标
5. 观看计算动画（3秒）
6. 查看恢复天数结果
7. 进入主页开始打卡

---

## 💡 测试不同恢复天数

想测试不同的恢复天数结果，可以在问卷中选择不同答案：

### 获得较短天数（21-30天）：
- 分手时间：6个月以上
- 关系持续：不到1个月
- 当前感觉：感觉好多了
- 联系频率：从不
- 查看动态：从不/已拉黑
- 应对方式：和朋友聊天
- 愈合进度：我感觉好多了

### 获得较长天数（50-60天）：
- 分手时间：不到1周
- 关系持续：5年以上
- 当前感觉：还在震惊中
- 联系频率：每天都有
- 谁结束的：我的前任
- 查看动态：每天多次
- 最大困扰：经常想念前任
- 应对方式：不知道怎么办
- 愈合进度：完全没有

---

## 📊 数据结构

### 问卷答案（questionnaireAnswers）
```javascript
{
  gender: 1,              // 1=男性, 2=女性
  breakupTime: 2,         // 1-5
  relationshipDuration: 4, // 1-6
  currentFeeling: 2,      // 1-5
  contactFrequency: 1,    // 1-4
  whoEnded: 2,            // 1-4
  checkDynamic: 1,        // 1-4
  biggestTrouble: 1,      // 1-7
  copingMethod: 2,        // 1-5
  healingProgress: 1      // 1-4
}
```

### 评估结果（assessment）
```javascript
{
  answers: {...},         // 问卷答案
  goal: 1,                // 选择的目标
  recoveryDays: 45,       // 计算出的恢复天数
  startDate: 1704355200000 // 开始时间戳
}
```

---

## 🎯 核心算法说明

**位置**：[utils/calculator.js](utils/calculator.js)

算法根据10个问题的回答，对用户状态进行综合评分（0-100分），然后映射到10个天数枚举值。

**设计原则**：
- 分手越早、关系越长 → 需要更多时间
- 情绪越差、联系越多 → 需要更多时间
- 被动分手、应对不当 → 需要更多时间
- 已有进展、积极应对 → 需要较少时间

---

## ✅ 完成清单

- [x] 10个问题单题展示
- [x] 顶部进度条
- [x] 目标选择页面
- [x] 计算中动画
- [x] 智能天数计算（21-60天，10个枚举值）
- [x] 结果展示页面
- [x] 动态任务生成
- [x] 主页显示恢复天数

---

**现在可以开始测试了！** 🎉

如有任何问题或需要调整，请随时告诉我。
